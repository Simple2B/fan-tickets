{% extends "landing/base.html" %}

{% block main_content %}
{% set all_filters = "[name='location'], [name='date_from'], [name='date_to'], [name='categories'], [name='q'],
[name='search_args'], [name='tickets_per_page']" %}

<input type="hidden" name="tickets_per_page" id="tickets_per_page" value="{{ tickets|length }}" />

<div class="my-16 self-start flex flex-col gap-2">
    <h1 class="text-6xl">Ingressos</h1>
</div>


{% if ticket %}
{% set all_filters = "[name='room_unique_id'],[name='event_unique_id'], [name='ticket_unique_id']" %}
<input type="hidden" name="ticket_unique_id" value="{{ ticket.unique_id }}">
<input type="hidden" name="user_unique_id" value="{{ current_user.unique_id }}">
<!-- <button type="button" hx-get="{{ url_for('buy.booking_ticket', from_web=True) }}" hx-target="#chat-body"
  hx-swap="innerHTML" hx-trigger="click" id="chat-start-buy-ticket" hx-include="{{ all_filters }}"
  class="flex gap-2 cursor-pointer">
  <div class="p-2 h-max self-end rounded-full bg-dark-grey">
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">
      <path
        d="M14.5158 0H12.3845C11.8992 0 11.4601 0.252772 11.1879 0.653633C10.4998 1.67493 9.32627 2.34899 7.99615 2.34899C6.66602 2.34899 5.49254 1.67749 4.80436 0.653633C4.53475 0.252772 4.09308 0 3.60777 0H1.48162C0.662494 0 0 0.658739 0 1.47323V14.4335C0 15.248 0.662494 15.9068 1.48162 15.9068H3.61034C4.09565 15.9068 4.53475 15.654 4.80693 15.2531C5.4951 14.2318 6.66859 13.5578 7.99872 13.5578C9.32884 13.5578 10.5023 14.2293 11.1905 15.2531C11.4601 15.654 11.9018 15.9068 12.3871 15.9068H14.5184C15.3375 15.9068 16 15.248 16 14.4335V1.47323C16 0.658739 15.3375 0 14.5184 0H14.5158ZM5.0406 4.24861H10.9568C11.306 4.24861 11.5911 4.53202 11.5911 4.87927C11.5911 5.22651 11.306 5.50992 10.9568 5.50992H5.0406C4.69138 5.50992 4.40635 5.22651 4.40635 4.87927C4.40635 4.53202 4.69138 4.24861 5.0406 4.24861ZM4.55272 8.02998H3.03258C2.68336 8.02998 2.39833 7.74657 2.39833 7.39933C2.39833 7.05208 2.68336 6.76867 3.03258 6.76867H4.55272C4.90194 6.76867 5.18697 7.05208 5.18697 7.39933C5.18697 7.74657 4.90194 8.02998 4.55272 8.02998ZM11.1314 10.3662C10.2687 11.2241 9.13369 11.6556 7.99872 11.6556C6.86375 11.6556 5.72878 11.2267 4.86599 10.3662C4.61948 10.1211 4.61948 9.72023 4.86599 9.47512C5.1125 9.23001 5.51565 9.23001 5.76216 9.47512C6.9947 10.7007 9.00273 10.7007 10.2353 9.47512C10.4818 9.23001 10.8849 9.23001 11.1314 9.47512C11.3779 9.72023 11.3779 10.1211 11.1314 10.3662ZM12.9649 8.02998H7.04863C6.69941 8.02998 6.41438 7.74657 6.41438 7.39933C6.41438 7.05208 6.69941 6.76867 7.04863 6.76867H12.9649C13.3141 6.76867 13.5991 7.05208 13.5991 7.39933C13.5991 7.74657 13.3141 8.02998 12.9649 8.02998Z"
        fill="#F2B705" />
    </svg>
  </div>
  <div class="">
    <div class="p-4 text-white bg-dark-grey rounded-t-lg rounded-br-lg justify-start">
      <p>{{ ticket.event.name }}</p>
      <p>{{ ticket.event.location.name }}</p>
      <p>{{ ticket.event.venue }}</p>
      <p>{{ cut_seconds(ticket.event.date_time) }}</p>
      <p class="text-secondary">
        R$ {{ ticket.price_net }}
        {% if ticket.is_paired %}
        (R$ {{ 2 * ticket.price_net }} for 2 tickets)
        {% endif %}
      </p>
      <p class="text-xs text-gray-500">
        Section {{ ticket.section }} - Queue {{ ticket.queue }} - Seat {{ ticket.seat}}
      </p>
      {% if ticket.description %}
      <p><span class="text-secondary">Note:</span> {{ ticket.description }}</p>
      {% endif %}
    </div>
  </div>
</button> -->
<button type="button" hx-get="{{ url_for('buy.booking_ticket_from_web', from_web=True) }}" hx-target="#chat-body"
    hx-swap="innerHTML" hx-trigger="click" id="chat-start-buy-ticket" hx-include="{{ all_filters }}"
    class="p-3 w-265 sm:w-1/2 flex text-white bg-dark-grey justify-between items-center rounded-lg">
    <div class="flex flex-col gap-1">
        <h3 class="mb-2">{{ ticket.event.name }}</h3>
        <span class="text-grey">{{ ticket.event.location.name }}</span>
        <span class="text-grey">{{ ticket.event.venue }}</span>
        <span class="text-grey">{{ cut_seconds(ticket.event.date_time) }}</span>
        <div>
            {% if ticket.is_paired %}
            <span class="text-secondary mb-0">R${{ get_price_gross(ticket) * 2 }}</span>
            <small class="text-xs text-gray-500">for 2 tickets</small>
            {% else %}
            <p class="text-secondary mt-0">R${{ get_price_gross(ticket) }}</p>
            {% endif %}
            <p class="text-xs text-grey">
                {% if ticket.section %}
                Section: {{ ticket.section }} &#8226;
                {% endif %}
                {% if ticket.queue %}
                Q: {{ ticket.queue }} &#8226;
                {% endif %}
                {% if ticket.seat %}
                Seat: {{ ticket.seat }}
                {% endif %}
            </p>
        </div>
        {% if ticket.description %}
        <p><span class="text-secondary">Note:</span> {{ ticket.description }}</p>
        {% endif %}
    </div>
    <div>
        <div class="flex items-center gap-2 py-1.5 px-3 bg-middle-grey rounded-full">
            <!-- prettier-ignore -->
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path
                    d="M14.8215 1.37708L14.8218 1.3766C14.9876 1.12906 15.2388 1 15.485 1H18.148C18.6187 1 19 1.38128 19 1.852V18.148C19 18.6187 18.6187 19 18.148 19H15.485C15.2388 19 14.9876 18.8709 14.8218 18.6234L14.8215 18.6229C13.7818 17.0731 12.0105 16.049 10 16.049C7.98951 16.049 6.21822 17.0731 5.17854 18.6229L5.17822 18.6234C5.01219 18.8712 4.76191 19 4.515 19H1.852C1.38128 19 1 18.6187 1 18.148V1.852C1 1.38128 1.38128 1 1.852 1H4.515C4.76122 1 5.01237 1.12906 5.17822 1.3766L5.17854 1.37708C6.21815 2.92685 7.9884 3.951 10 3.951C12.0116 3.951 13.7818 2.92685 14.8215 1.37708Z"
                    stroke="#F2B705" stroke-width="2" />
            </svg>
            {% if ticket.is_paired %}
            <span class="text-secondary">2</span>
            {% else %}
            <span class="text-secondary">1</span>
            {% endif %}
        </div>
    </div>
</button>
{% else %}
<h2>Nenhum ingresso encontrado</h2>
{% endif %}
{% endblock %}

{% block scripts %}
<script src="{{ url_for('static', filename='js/flowbite_datepicker.js') }}" type="text/javascript" defer></script>
<script src="{{ url_for('static', filename='js/event.js') }}" type="text/javascript" defer></script>
{% endblock %}