{% extends 'base.html' %} {% block content %}
<div class="relative overflow-x-auto shadow-md sm:rounded-lg">
  <div class="mt-3 flex justify-between">
    <p class="my-6 ml-3 text-3xl dark:text-gray-400">Tickets</p>
  </div>

  <form action="{{url_for('admin.get_tickets')}}" class="m-3">
    <div class="flex justify-between">
      <div class="cursor-pointer">
        <p class="text-gray-400">Location</p>
        <select name="location_id"
          class="admin-select w-40 bg-black text-gray-400 border border-gray-400 rounded-lg cursor-pointer">
          <option value="all">All</option>
          {% for location in locations %}
          {% if location.unique_id == location_unique_id %}
          <option value="{{ location.id }}" selected>{{ location.name }}</option>
          {% else %}
          <option value="{{ location.id }}">{{ location.name }}</option>
          {% endif %}
          {% endfor %}
        </select>
      </div>

      <div class="relative w-max cursor-pointer">
        <p class="text-gray-400">Dates</p>
        <div id="event-dates"
          class="admin-select w-40 h-10 flex items-center bg-black text-gray-400 border border-gray-400 rounded-lg cursor-pointer">
          <p class="ms-3">Choose dates</p>
        </div>

        <div id="event-dates-dropdown" class="hidden absolute bg-black border border-gray-400 rounded-lg text-gray-400">
          <p class="m-2">Date from</p>
          <input datepicker type="text" name="date_from" autocomplete="off" id="date-from"
            class="max-w-2xl border-0 text-black placeholder:text-black text-sm rounded-lg focus:ring-secondary block w-full p-2 dark:bg-black dark:placeholder-white dark:text-white dark:focus:ring-secondary cursor-pointer"
            placeholder="{{ today() }}" />

          <p class="m-2">Date to</p>
          <input datepicker type="text" name="date_to" autocomplete="off" id="date-to"
            class="max-w-2xl border-0 text-black placeholder:text-black text-sm rounded-lg focus:ring-secondary block w-full p-2 dark:bg-black dark:placeholder-white dark:text-white dark:focus:ring-secondary cursor-pointer"
            placeholder="{{ today() }}" />
        </div>
        <svg class="absolute right-2 top-1/2 w-5 fill-current" width="24" height="24" viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg">
          <path fill-rule="evenodd" clip-rule="evenodd"
            d="M18.601 8.39897C18.269 8.06702 17.7309 8.06702 17.3989 8.39897L12 13.7979L6.60099 8.39897C6.26904 8.06702 5.73086 8.06702 5.39891 8.39897C5.06696 8.73091 5.06696 9.2691 5.39891 9.60105L11.3989 15.601C11.7309 15.933 12.269 15.933 12.601 15.601L18.601 9.60105C18.9329 9.2691 18.9329 8.73091 18.601 8.39897Z"
            fill="rgb(120 120 120)"></path>
        </svg>
      </div>

      <div class="cursor-pointer">
        <p class="text-gray-400">Ticket type</p>
        <select name="ticket_type"
          class="admin-select w-40 bg-black text-gray-400 border border-gray-400 rounded-lg cursor-pointer">
          <option value="all">All</option>
          {% for ticket_type in ticket_types %}
          {% if ticket_type == ticket_type_selected %}
          <option value="{{ ticket_type }}" selected>{{ ticket_type }}</option>
          {% else %}
          <option value="{{ ticket_type }}">{{ ticket_type }}</option>
          {% endif %}
          {% endfor %}
        </select>
      </div>

      <div class="cursor-pointer">
        <p class="text-gray-400">Ticket category</p>
        <select name="ticket_category"
          class="admin-select w-40 bg-black text-gray-400 border border-gray-400 rounded-lg cursor-pointer">
          <option value="all">All</option>
          {% for ticket_category in ticket_categories %}
          {% if ticket_category == ticket_category_selected %}
          <option value="{{ ticket_category }}" selected>{{ ticket_category }}</option>
          {% else %}
          <option value="{{ ticket_category }}">{{ ticket_category }}</option>
          {% endif %}
          {% endfor %}
        </select>
      </div>
    </div>

    <div class="my-5 flex justify-center">
      <div>
        <button type="submit"
          class="link mx-2 p-2 w-44 text-center text-secondary border border-secondary rounded-xl transition-colors duration-200">
          Apply
        </button>
      </div>

      <a href="{{url_for('admin.get_tickets', locatoin_id=all, ticket_type=all)}}">
        <button type="button"
          class="link mx-2 p-2 w-44 text-center text-gray-400 border border-gray-400 rounded-xl transition-colors duration-200">
          reset
        </button>
      </a>
    </div>
  </form>

  <table class="w-full text-sm text-left text-gray-500 dark:text-gray-400">
    <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:text-black dark:bg-secondary">
      <tr>
        <th scope="col" class="px-6 py-3">#</th>
        <th scope="col" class="px-6 py-3">Event Name</th>
        <th scope="col" class="px-6 py-3">date</th>
        <th scope="col" class="px-6 py-3">price</th>
        <th scope="col" class="px-6 py-3">seller</th>
        <th scope="col" class="px-6 py-3">buyer</th>
        <th scope="col" class="px-6 py-3">is_available</th>
      </tr>
    </thead>
    <tbody>
      {% for ticket in tickets %}
      <tr class="bg-white border-b dark:bg-black dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600">
        <td class="w-4 p-4">
          <div class="flex items-center">{{ loop.index + page.skip }}</div>
        </td>
        <td scope="row" class="flex items-center px-6 py-4 text-gray-900 whitespace-nowrap dark:text-white">
          <a href="{{ url_for('admin.get_ticket', ticket_unique_id=ticket.unique_id) }}" class="pl-3">
            <div class="text-base font-semibold">{{ ticket.event.name }}</div>
            <p>
              {{ ticket.event.location.name }}
              <span>{{ ticket.event.category.name }}</span>
            </p>
          </a>
        </td>
        <td class="p-4 space-x-2 whitespace-nowrap">
          {{ date_from_datetime(ticket.event.date_time) }}
        </td>
        <td class="p-4 space-x-2 whitespace-nowrap">
          {{ round_to_two_places(ticket.price_gross) }}
        </td>
        <td class="p-4 space-x-2 whitespace-nowrap">
          {{ ticket.seller.username }}
        </td>
        <td class="p-4 space-x-2 whitespace-nowrap">
          {{ ticket.buyer.username }}
        </td>
        <td class="p-4 space-x-2 whitespace-nowrap">
          {{ ticket.is_available }}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>

<!-- Pagination -->
{% if page.pages > 1 %}
<div class="container content-center pagination-block-centered w-full mt-3 flex bg-white dark:bg-black">
  <nav aria-label="Page navigation example" class="mx-auto">
    <ul class="inline-flex items-center -space-x-px">
      <li>
        <!-- prettier-ignore -->
        <a href="{{ url_for('admin.get_tickets') }}?page=1&location_id={{location_id}}&ticket_type={{ticket_type_selected}}&ticket_category={{ticket_category_selected}}&date_from={{date_from}}&date_to={{date_to}}"
          class="block px-3 py-2 ml-0 leading-tight text-gray-500 bg-white border border-gray-300 rounded-l-lg hover:bg-gray-100 hover:text-gray-700 dark:bg-black dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">
          <span class="sr-only">First</span>
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
            <path fill-rule="evenodd"
              d="M15.79 14.77a.75.75 0 01-1.06.02l-4.5-4.25a.75.75 0 010-1.08l4.5-4.25a.75.75 0 111.04 1.08L11.832 10l3.938 3.71a.75.75 0 01.02 1.06zm-6 0a.75.75 0 01-1.06.02l-4.5-4.25a.75.75 0 010-1.08l4.5-4.25a.75.75 0 111.04 1.08L5.832 10l3.938 3.71a.75.75 0 01.02 1.06z"
              clip-rule="evenodd" />
          </svg>
        </a>
      </li>
      <li>
        <!-- prettier-ignore -->
        <a href="{{ url_for('admin.get_tickets') }}?page={{page.page-1 if page.page > 1 else 1}}&location_id={{location_id}}&ticket_type={{ticket_type_selected}}&ticket_category={{ticket_category_selected}}&date_from={{date_from}}&date_to={{date_to}}"
          class="block px-3 py-2 ml-0 leading-tight text-gray-500 bg-white border border-gray-300 rounded-l-lg hover:bg-gray-100 hover:text-gray-700 dark:bg-black dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">
          <span class="sr-only">Previous</span>
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
            <path fill-rule="evenodd"
              d="M12.79 5.23a.75.75 0 01-.02 1.06L8.832 10l3.938 3.71a.75.75 0 11-1.04 1.08l-4.5-4.25a.75.75 0 010-1.08l4.5-4.25a.75.75 0 011.06.02z"
              clip-rule="evenodd" />
          </svg>
        </a>
      </li>

      <!-- prettier-ignore -->
      {% for p in page.pages_for_links %}
      <li>
        <!-- prettier-ignore -->
        {% if p == page.page %}
        <!-- prettier-ignore -->
        <a href="{{ url_for('admin.get_tickets') }}?page={{p}}&location_id={{location_id}}&ticket_type={{ticket_type_selected}}&ticket_category={{ticket_category_selected}}&date_from={{date_from}}&date_to={{date_to}}"
          aria-current="page"
          class="z-10 px-3 py-2 leading-tight text-blue-600 border border-blue-300 bg-blue-50 hover:bg-blue-100 hover:text-blue-700 dark:border-gray-700 dark:bg-gray-700 dark:text-white">{{p}}</a>
        {% else %}
        <!-- prettier-ignore -->
        <a href="{{ url_for('admin.get_tickets') }}?page={{p}}&location_id={{location_id}}&ticket_type={{ticket_type_selected}}&ticket_category={{ticket_category_selected}}&date_from={{date_from}}&date_to={{date_to}}"
          class="px-3 py-2 leading-tight text-gray-500 bg-white border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:bg-black dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">{{p}}</a>
        {% endif %}
      </li>
      {% endfor %}

      <li>
        <!-- prettier-ignore -->
        <a href="{{ url_for('admin.get_tickets') }}?page={{page.page+1 if page.page < page.pages else page.pages}}&location_id={{location_id}}&ticket_type={{ticket_type_selected}}&ticket_category={{ticket_category_selected}}&date_from={{date_from}}&date_to={{date_to}}"
          class="block px-3 py-2 leading-tight text-gray-500 bg-white border border-gray-300 rounded-r-lg hover:bg-gray-100 hover:text-gray-700 dark:bg-black dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">
          <!-- prettier-ignore -->
          <span class="sr-only">Next</span>
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
            <path fill-rule="evenodd"
              d="M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z"
              clip-rule="evenodd" />
          </svg>
        </a>
      </li>
      <li>
        <!-- prettier-ignore -->
        <a href="{{ url_for('admin.get_tickets') }}?page={{page.pages}}&location_id={{location_id}}&ticket_type={{ticket_type_selected}}&ticket_category={{ticket_category_selected}}&date_from={{date_from}}&date_to={{date_to}}"
          class="block px-3 py-2 leading-tight text-gray-500 bg-white border border-gray-300 rounded-r-lg hover:bg-gray-100 hover:text-gray-700 dark:bg-black dark:border-gray-700 dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white">
          <!-- prettier-ignore -->
          <span class="sr-only">Last</span>
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
            <path fill-rule="evenodd"
              d="M10.21 14.77a.75.75 0 01.02-1.06L14.168 10 10.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z"
              clip-rule="evenodd" />
            <path fill-rule="evenodd"
              d="M4.21 14.77a.75.75 0 01.02-1.06L8.168 10 4.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z"
              clip-rule="evenodd" />
          </svg>
        </a>
      </li>
    </ul>
  </nav>
</div>

<div class="mt-5 flex justify-center">
  <a href="{{ url_for('admin.get_tickets', download=true) }}">
    <button type="button"
      class="link mx-2 p-2 w-44 text-center text-secondary border border-secondary rounded-xl transition-colors duration-200">
      Download
    </button>
  </a>
</div>
</div>
{% endif %}

{% endblock %}
{% block scripts %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/flowbite/2.1.1/datepicker.min.js" defer></script>
<script src="{{ url_for('static', filename='js/admin.js') }}" type="text/javascript" defer></script>
{% endblock %}